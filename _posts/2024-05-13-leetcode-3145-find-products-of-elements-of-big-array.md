---
layout      : single
title       : LeetCode 3145. Find Products of Elements of Big Array
tags        : LeetCode
---
雙周賽 130。又是難題，比賽中連完整做法都想不出來。我猜應該有 2900 分。  

## 題目

一個整數 x 的**強陣列**指的是由二的冪組成，且和為 x 的有序陣列。  
例如 11 的 強陣列是 [1, 2, 8]。  

big_nums 是由無限**遞增**的正整數數列 [1, 2, 3, ...] 的**強陣列**串接組成。  
big_nums 的開頭為 [<u>1</u>, <u>2</u>, <u>1, 2</u>, <u>4</u>, <u>1, 4</u>, <u>2, 4</u>, <u>1, 2, 4</u>, <u>8</u>, ...]。  

輸入二維整數陣列 queries，其中 queries[i] = [from<sub>i</sub>, to<sub>i</sub>, mod<sub>i</sub>]，你必須計算 (big_nums[from<sub>i</sub>] \* big_nums[from<sub>i+1</sub>] \* ... \* big_nums[to<sub>i</sub>]) % mod<sub>i</sub>。

回傳整數陣列 answer，其中 answer[i] 代表第 i 次查詢的答案。  

## 解法

首先注意到 big_nums 的查詢範圍高達 10^15，不可能真的生出整個陣列。  
而區間 [s, e] 的**乘積**等價於 [1, e] 的乘積除 [1, s - 1] 的乘積，有點類似前綴和的關係。  

查詢要對 mod 求餘數，會想到**乘法逆元**。很可惜 mod 不是質數，派不上用場。  

---

仔細看看**強陣列**的定義，都是由**二的冪次**所組成。  
例如：強陣列 [1, 2, 8] 的乘積可以看做 2^0 \* 2^1 \* 2^3，也就是 2^4 = 16。  
如此一來，可以改求 [1, x] 的**冪次和**，再透過前綴和得出 [s, e] 的冪次和 p，答案為 2^p。
但是 p 可能很大，暴力計算會超時，記得使用**快速冪**。  

---
